# B-0002 â€” Protobuf contracts v1 + buf pipeline

## Goal
Establish protobuf as the single source of truth and enforce lint/breaking checks.

## Scope
- Create `contracts/proto/**.proto` for: trading, marketdata, ledger
- Add `buf.yaml`, `buf.gen.yaml`
- Generate stubs for Go/Rust/Kotlin
- Add CI checks: buf lint + breaking

## Acceptance Criteria
- `buf lint` passes
- `buf breaking` gate enabled (against main branch)
- Stubs generated deterministically (no manual edits)
- Versioning strategy documented (event_version, package v1)

## Tests
- Unit: schema compilation
- CI: failing proto change blocks merge
- Golden example messages compile in all languages

## Observability
- Metric: generated code checksum in CI (optional)
- Log: contract version used at runtime

## Rollback / Recovery
- If breaking, revert proto change or bump major package version (v2) and add compatibility path

## Dependencies
- I-0001
