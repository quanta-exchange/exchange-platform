# B-0401 — Flink candles 1m aggregator v1 (trade stream → candles)

## Goal
Build a deterministic candle generator from TradeExecuted stream.

## Scope
- Consume trade events
- Produce CandleUpdated progress + is_final at boundary
- Sink history to ClickHouse

## Acceptance Criteria
- Candle boundaries correct
- Out-of-order handling rule documented (prefer engine seq)
- Replay yields identical candles

## Tests
- Reference aggregator comparison tests
- Boundary condition tests

## Observability
- Metrics: candle_lag_ms, candle_updates_total
- Alert: job restart loops

## Rollback / Recovery
- If job fails, disable candle WS updates and rely on REST history once restored

## Dependencies
- B-0002
- I-0003
