# B-0403 â€” ClickHouse schema for trades/candles + query performance targets

## Goal
Create ClickHouse tables and partitions for high-volume history and ensure p99 query latency targets.

## Scope
- trades table (partition by day, order by symbol+ts)
- candles table (partition by day, order by symbol+interval+openTime)
- Ingestion from Flink and/or Kafka Connect
- Query endpoints use ClickHouse efficiently

## Acceptance Criteria
- Queries for recent ranges meet p99 targets in staging
- Backfill strategy defined

## Tests
- Load tests for query endpoints
- Explain/analyze query plans

## Observability
- Metrics: ch_query_p99, ch_insert_rate

## Rollback / Recovery
- If CH underperforms, adjust partition/order keys; temporary reduce retention

## Dependencies
- B-0401
