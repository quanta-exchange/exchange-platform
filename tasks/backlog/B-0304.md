# B-0304 â€” Balances materialization v1 + rebuild tooling

## Goal
Provide fast read balances while keeping ledger as source of truth and enabling rebuild.

## Scope
- MV table: account_balances(account_id,currency,balance,updated_at)
- Update method: consumer applies ledger postings
- Rebuild tool: recompute balances from ledger (by time range/account)

## Acceptance Criteria
- Balance API p99 < 30ms for hot reads
- Rebuild produces identical results
- Can recover from MV corruption

## Tests
- Integration tests: apply postings updates MV
- Rebuild correctness test
- Simulated corruption test

## Observability
- Metrics: balance_compute_lag_ms, rebuild_duration_ms

## Rollback / Recovery
- If MV diverges, serve reads from rebuilt MV and keep trading restricted until reconciliation passes

## Dependencies
- B-0301
