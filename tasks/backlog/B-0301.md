# B-0301 â€” Ledger schema v1 (double-entry, append-only)

## Goal
Design and migrate PostgreSQL schema for ledger entries and postings.

## Scope
- Tables: accounts, ledger_entries, ledger_postings, idempotency
- Append-only enforcement by privileges
- Unique keys for idempotency (reference_type, reference_id, entry_kind)
- Money stored as min-unit BIGINT + currency code

## Acceptance Criteria
- Double-entry invariants can be checked
- Duplicate trade cannot create duplicate entries
- No UPDATE/DELETE permitted for ledger tables (prod role)

## Tests
- Migration tests on clean DB
- Constraint tests: invalid inputs rejected

## Observability
- Metrics: ledger_append_latency_ms, unique_violation_total

## Rollback / Recovery
- If migration causes issues, rollback to previous schema version and stop settlement consumer

## Dependencies
- I-0003
